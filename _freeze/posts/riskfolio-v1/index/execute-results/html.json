{
  "hash": "a9f424706d7899b9908f18386c456e3b",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Combined Language Analysis with Features\ndescription: 'Being unobservable, it cleaves to a subjective model'\nauthor: 'David Harper, CFA, FRM'\ndate: '2023-11-12'\ncategories:\n  - code\n  - analysis\nformat:\n  html:\n    code-fold: true\nengines:\n  r: default\n---\n\n# Advanced Python Example\n\nThis section demonstrates more complex Python capabilities, such as numerical computations with NumPy and plotting with Matplotlib.\n\n::: {#a5eee8a8 .cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np\nimport pandas as pd\nimport riskfolio as rp\nimport matplotlib.pyplot as plt\nimport yfinance as yf\nimport warnings\n\nwarnings.filterwarnings(\"ignore\")\npd.options.display.float_format = '{:.4%}'.format\n\n# Date range\nstart = '2016-01-01'\nend = '2019-12-30'\n\n# Tickers of assets\nassets = ['JCI', 'TGT', 'CMCSA', 'CPB', 'MO', 'APA', 'MMC', 'JPM',\n          'ZION', 'PSA', 'BAX', 'BMY', 'LUV', 'PCAR', 'TXT', 'TMO',\n          'DE', 'MSFT', 'HPQ', 'SEE', 'VZ', 'CNP', 'NI', 'T', 'BA']\nassets.sort()\n\n# Downloading data\ndata = yf.download(assets, start = start, end = end)\ndata = data.loc[:,('Adj Close', slice(None))]\ndata.columns = assets\n\nY = data[assets].pct_change().dropna()\n\ndisplay(Y.head())\n\n#\n#\n\n\n\n# Building the portfolio object\nport = rp.Portfolio(returns=Y)\n\n# Calculating optimal portfolio\n\n# Select method and estimate input parameters:\n\nmethod_mu='hist' # Method to estimate expected returns based on historical data.\nmethod_cov='hist' # Method to estimate covariance matrix based on historical data.\n\nport.assets_stats(method_mu=method_mu, method_cov=method_cov, d=0.94)\n\n# Estimate optimal portfolio:\n\nmodel='Classic' # Could be Classic (historical), BL (Black Litterman) or FM (Factor Model)\nrm = 'MV' # Risk measure used, this time will be variance\nobj = 'Sharpe' # Objective function, could be MinRisk, MaxRet, Utility or Sharpe\nhist = True # Use historical scenarios for risk measures that depend on scenarios\nrf = 0 # Risk free rate\nl = 0 # Risk aversion factor, only useful when obj is 'Utility'\n\nw = port.optimization(model=model, rm=rm, obj=obj, rf=rf, l=l, hist=hist)\n\ndisplay(w.T)\n\n#\n# Plotting the composition of the portfolio\nplt.figure(figsize=(10, 6))\nax = rp.plot_pie(w=w, title='Sharpe Mean Variance', others=0.05, \nnrow=25, cmap = \"tab20\", height=3, width=5, ax=None)\n\npoints = 50 # Number of points of the frontier\nfrontier = port.efficient_frontier(model=model, rm=rm, points=points, rf=rf, hist=hist)\ndisplay(frontier.T.head())\n\n# Plotting the efficient frontier\n\nlabel = 'Max Risk Adjusted Return Portfolio' # Title of point\nmu = port.mu # Expected returns\ncov = port.cov # Covariance matrix\nreturns = port.returns # Returns of the assets\nplt.figure(figsize=(10, 6))\nax = rp.plot_frontier(w_frontier=frontier, mu=mu, cov=cov, returns=returns, rm=rm,\n                      rf=rf, alpha=0.05, cmap='viridis', w=w, label=label,\n                      marker='*', s=16, c='r', height=3, width=5, ax=None)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\r[                       0%%                      ]\r[                       0%%                      ]\r[******                12%%                      ]  3 of 25 completed\r[********              16%%                      ]  4 of 25 completed\r[********              16%%                      ]  4 of 25 completed\r[********              16%%                      ]  4 of 25 completed\r[*************         28%%                      ]  7 of 25 completed\r[***************       32%%                      ]  8 of 25 completed\r[*****************     36%%                      ]  9 of 25 completed\r[*****************     36%%                      ]  9 of 25 completed\r[*****************     36%%                      ]  9 of 25 completed\r[*****************     36%%                      ]  9 of 25 completed\r[**********************52%%                      ]  13 of 25 completed\r[**********************56%%*                     ]  14 of 25 completed\r[**********************60%%***                   ]  15 of 25 completed\r[**********************64%%*****                 ]  16 of 25 completed\r[**********************68%%*******               ]  17 of 25 completed\r[**********************72%%*********             ]  18 of 25 completed\r[**********************76%%**********            ]  19 of 25 completed\r[**********************80%%************          ]  20 of 25 completed\r[**********************80%%************          ]  20 of 25 completed\r[**********************88%%****************      ]  22 of 25 completed\r[**********************92%%******************    ]  23 of 25 completed\r[**********************96%%********************  ]  24 of 25 completed\r[*********************100%%**********************]  25 of 25 completed\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>APA</th>\n      <th>BA</th>\n      <th>BAX</th>\n      <th>BMY</th>\n      <th>CMCSA</th>\n      <th>CNP</th>\n      <th>CPB</th>\n      <th>DE</th>\n      <th>HPQ</th>\n      <th>JCI</th>\n      <th>...</th>\n      <th>NI</th>\n      <th>PCAR</th>\n      <th>PSA</th>\n      <th>SEE</th>\n      <th>T</th>\n      <th>TGT</th>\n      <th>TMO</th>\n      <th>TXT</th>\n      <th>VZ</th>\n      <th>ZION</th>\n    </tr>\n    <tr>\n      <th>Date</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2016-01-05</th>\n      <td>-2.0257%</td>\n      <td>0.4057%</td>\n      <td>0.4035%</td>\n      <td>1.9692%</td>\n      <td>0.0180%</td>\n      <td>0.9305%</td>\n      <td>0.3678%</td>\n      <td>0.5783%</td>\n      <td>0.9483%</td>\n      <td>-1.1953%</td>\n      <td>...</td>\n      <td>1.5881%</td>\n      <td>0.0212%</td>\n      <td>2.8236%</td>\n      <td>0.9758%</td>\n      <td>0.6987%</td>\n      <td>1.7539%</td>\n      <td>-0.1730%</td>\n      <td>0.2410%</td>\n      <td>1.3734%</td>\n      <td>-1.0857%</td>\n    </tr>\n    <tr>\n      <th>2016-01-06</th>\n      <td>-11.4863%</td>\n      <td>-1.5879%</td>\n      <td>0.2412%</td>\n      <td>-1.7556%</td>\n      <td>-0.7727%</td>\n      <td>-1.2473%</td>\n      <td>-0.1736%</td>\n      <td>-1.1239%</td>\n      <td>-3.5867%</td>\n      <td>-0.9551%</td>\n      <td>...</td>\n      <td>0.5547%</td>\n      <td>0.0212%</td>\n      <td>0.1592%</td>\n      <td>-1.5646%</td>\n      <td>0.3108%</td>\n      <td>-1.0155%</td>\n      <td>-0.7653%</td>\n      <td>-3.0048%</td>\n      <td>-0.9035%</td>\n      <td>-2.9144%</td>\n    </tr>\n    <tr>\n      <th>2016-01-07</th>\n      <td>-5.1388%</td>\n      <td>-4.1922%</td>\n      <td>-1.6573%</td>\n      <td>-2.7699%</td>\n      <td>-1.1046%</td>\n      <td>-1.9769%</td>\n      <td>-1.2206%</td>\n      <td>-0.8856%</td>\n      <td>-4.6058%</td>\n      <td>-2.5394%</td>\n      <td>...</td>\n      <td>-2.2066%</td>\n      <td>-3.0309%</td>\n      <td>-1.0410%</td>\n      <td>-3.1557%</td>\n      <td>-1.6148%</td>\n      <td>-0.2700%</td>\n      <td>-2.2845%</td>\n      <td>-2.0570%</td>\n      <td>-0.5492%</td>\n      <td>-3.0020%</td>\n    </tr>\n    <tr>\n      <th>2016-01-08</th>\n      <td>0.2736%</td>\n      <td>-2.2705%</td>\n      <td>-1.6037%</td>\n      <td>-2.5425%</td>\n      <td>0.1099%</td>\n      <td>-0.2241%</td>\n      <td>0.5707%</td>\n      <td>-1.6402%</td>\n      <td>-1.7642%</td>\n      <td>-0.1649%</td>\n      <td>...</td>\n      <td>-0.1538%</td>\n      <td>-1.1366%</td>\n      <td>-0.7308%</td>\n      <td>-0.1449%</td>\n      <td>0.0895%</td>\n      <td>-3.3839%</td>\n      <td>-0.1117%</td>\n      <td>-1.1386%</td>\n      <td>-0.9720%</td>\n      <td>-1.1254%</td>\n    </tr>\n    <tr>\n      <th>2016-01-11</th>\n      <td>-4.3383%</td>\n      <td>0.1692%</td>\n      <td>-1.6851%</td>\n      <td>-1.0215%</td>\n      <td>0.0915%</td>\n      <td>-1.1791%</td>\n      <td>0.5674%</td>\n      <td>0.5288%</td>\n      <td>0.6616%</td>\n      <td>0.0330%</td>\n      <td>...</td>\n      <td>1.6435%</td>\n      <td>0.0000%</td>\n      <td>0.9870%</td>\n      <td>-0.1450%</td>\n      <td>1.2225%</td>\n      <td>1.4570%</td>\n      <td>0.5366%</td>\n      <td>-0.4607%</td>\n      <td>0.5799%</td>\n      <td>-1.9918%</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 25 columns</p>\n</div>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>APA</th>\n      <th>BA</th>\n      <th>BAX</th>\n      <th>BMY</th>\n      <th>CMCSA</th>\n      <th>CNP</th>\n      <th>CPB</th>\n      <th>DE</th>\n      <th>HPQ</th>\n      <th>JCI</th>\n      <th>...</th>\n      <th>NI</th>\n      <th>PCAR</th>\n      <th>PSA</th>\n      <th>SEE</th>\n      <th>T</th>\n      <th>TGT</th>\n      <th>TMO</th>\n      <th>TXT</th>\n      <th>VZ</th>\n      <th>ZION</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>weights</th>\n      <td>0.0000%</td>\n      <td>6.1590%</td>\n      <td>11.5019%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>8.4806%</td>\n      <td>0.0000%</td>\n      <td>3.8194%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>...</td>\n      <td>10.8264%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>7.1804%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>4.2740%</td>\n      <td>0.0000%</td>\n    </tr>\n  </tbody>\n</table>\n<p>1 rows × 25 columns</p>\n</div>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>APA</th>\n      <th>BA</th>\n      <th>BAX</th>\n      <th>BMY</th>\n      <th>CMCSA</th>\n      <th>CNP</th>\n      <th>CPB</th>\n      <th>DE</th>\n      <th>HPQ</th>\n      <th>JCI</th>\n      <th>...</th>\n      <th>NI</th>\n      <th>PCAR</th>\n      <th>PSA</th>\n      <th>SEE</th>\n      <th>T</th>\n      <th>TGT</th>\n      <th>TMO</th>\n      <th>TXT</th>\n      <th>VZ</th>\n      <th>ZION</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>5.2378%</td>\n      <td>4.3880%</td>\n      <td>2.1297%</td>\n      <td>6.9906%</td>\n      <td>3.2270%</td>\n      <td>0.0742%</td>\n      <td>0.0000%</td>\n      <td>2.8447%</td>\n      <td>...</td>\n      <td>11.4530%</td>\n      <td>0.0000%</td>\n      <td>14.9247%</td>\n      <td>0.1681%</td>\n      <td>6.5902%</td>\n      <td>4.0899%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>8.2767%</td>\n      <td>0.0000%</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0.0000%</td>\n      <td>2.0125%</td>\n      <td>8.4904%</td>\n      <td>0.7981%</td>\n      <td>1.6844%</td>\n      <td>8.5599%</td>\n      <td>2.1529%</td>\n      <td>1.3613%</td>\n      <td>0.0000%</td>\n      <td>1.0444%</td>\n      <td>...</td>\n      <td>13.4497%</td>\n      <td>0.0000%</td>\n      <td>9.2099%</td>\n      <td>0.0000%</td>\n      <td>5.5815%</td>\n      <td>5.5235%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>8.7591%</td>\n      <td>0.0000%</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0.0000%</td>\n      <td>2.8165%</td>\n      <td>9.3712%</td>\n      <td>0.0000%</td>\n      <td>1.1980%</td>\n      <td>9.1476%</td>\n      <td>1.7065%</td>\n      <td>1.7396%</td>\n      <td>0.0000%</td>\n      <td>0.0872%</td>\n      <td>...</td>\n      <td>14.2328%</td>\n      <td>0.0000%</td>\n      <td>6.4848%</td>\n      <td>0.0000%</td>\n      <td>5.1002%</td>\n      <td>6.0539%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>9.0039%</td>\n      <td>0.0000%</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0.0000%</td>\n      <td>3.4306%</td>\n      <td>9.9329%</td>\n      <td>0.0000%</td>\n      <td>0.5694%</td>\n      <td>9.5578%</td>\n      <td>1.0811%</td>\n      <td>1.9316%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>...</td>\n      <td>14.7708%</td>\n      <td>0.0000%</td>\n      <td>3.6630%</td>\n      <td>0.0000%</td>\n      <td>4.2578%</td>\n      <td>6.4249%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>9.2132%</td>\n      <td>0.0000%</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0.0000%</td>\n      <td>3.9343%</td>\n      <td>10.3865%</td>\n      <td>0.0000%</td>\n      <td>0.0003%</td>\n      <td>9.8874%</td>\n      <td>0.3998%</td>\n      <td>2.0811%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>...</td>\n      <td>15.1319%</td>\n      <td>0.0000%</td>\n      <td>1.0859%</td>\n      <td>0.0000%</td>\n      <td>3.3463%</td>\n      <td>6.7109%</td>\n      <td>0.0000%</td>\n      <td>0.0000%</td>\n      <td>9.2764%</td>\n      <td>0.0000%</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 25 columns</p>\n</div>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-2-output-5.png){width=490 height=278}\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-2-output-6.png){width=468 height=276}\n:::\n:::\n\n\n```{r}\n\n# Generate 100 random numbers from a normal distribution\nrandom_numbers <- rnorm(100, mean = 50, sd = 10)\n\n# Calculate summary statistics\nsummary_stats <- summary(random_numbers)\n\n# Print summary statistics\nprint(summary_stats)\n\n\n```\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}